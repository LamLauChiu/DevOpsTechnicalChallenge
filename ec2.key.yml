- hosts: vpc
  vars: #local connection defaults to using the system python
    ansible_python_interpreter: /Users/lauchiulam/Projects/DevOpsTechnicalChallenge/venv/bin/python3
  environment:
    AWS_ACCESS_KEY_ID: "{{ aws_access_key }}"
    AWS_SECRET_ACCESS_KEY: "{{ aws_secret_key }}"
    AWS_REGION: "{{ aws_region }}"
  tasks:
 
      - name: Create a new EC2 key
        ec2_key:
            name: "{{ vpc_key }}"
            region: ap-east-1
        register: ec2_key_result
 
      - name: Save private key
        copy: content="{{ ec2_key_result.key.private_key }}" dest="./aws.key.pem" mode=0600
        when: ec2_key_result.changed